# 1115 Web

> web_11부터 web_14의 if1까지



## 1115 이슈

1. Session Management with Cookie
2. Filter
3. JSTL
4. FrontController

## 1. Session Management with Cookie

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-01.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-01.png)

- public class **Cookie**
- extends java.lang.Object
- implements java.lang.Cloneable

Creates a cookie, **a small amount of information** sent by a servlet to a Web browser, saved by the browser, and later sent back to the server. A cookie's value can uniquely identify a client, so cookies are commonly used for session management.

- **a small amount of information**은 객체 저장이 안된다는 것을 의미
- servlet에 의해서 web browser로 보내짐.

| **Method Summary** |                                                              |
| ------------------ | ------------------------------------------------------------ |
| `void`             | `[addCookie](https://tomcat.apache.org/tomcat-5.5-doc/servletapi/javax/servlet/http/HttpServletResponse.html#addCookie(javax.servlet.http.Cookie))(Cookie cookie)` Adds the specified cookie to the response. |



#### CreatingCookie.java

```java
package web.servlet;
/*
 
  Cookie API
  
  1.  
  	 서버상에서 먼저 쿠키가 생성된다.
         이때 MAP방식으로 정보가 저장됨
     NAME(String)- VALUE(String)
     "Small amount of Information"
     -->
     Cookoie c = new Cookie("id","jaen");
     
  2. 
        응답시 클라이언트측으로 다시 보내진다.
     "정보를 저장하고 있는 쿠키가 클라이언트 측에 저장된다"
      -->
      response.addCookie(c);
      
  3. 
     두번쨰 요청시 다시 서버로 보내진다.
    이런식으로 서버와 클라이언트 사이드를 왔다갔다 하면서
    서버와 클라이언트를 계속 유지시켜주는 역할을 쿠키가 한다.
    쿠키안에 서버상의 정보를 저장하는 것이 아니라
    클라이언트를 구분하는 jsessionid값 쿠키에 담도록 자동화 되어져 있다.
    --> cookie[ ] cs = request.getCookies();
      
 */
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


@WebServlet("/CreatingCookie")
public class CreatingCookie extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
	protected void doProcess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	
		//1. Cookie 생성
		Cookie c1 = new Cookie("id", "jaen");
		Cookie c2 = new Cookie("today", "11-15-1052");
		
		//Cookie의 유효시간을 지정할수 있다.
		c1.setMaxAge(24*60*60*2);//하루동안 저장...
		c2.setMaxAge(0); //저장안됨.
		
		//2. 응답시 클라이언트로 다시 보낸다.
		response.addCookie(c1);
		response.addCookie(c2);
		
		//3.getCookie.jsp로 바로 이동
		//request.getRequestDispatcher("getCookie.jsp").forward(request, response);
		response.sendRedirect("getCookie.jsp");
		
		
	}
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doProcess(request,response);
	
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doProcess(request,response);
	}

}
```



#### cookie.html

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<b><a href="CreatingCookie">CreatingCookie 이동하기</a></b>
</body>
</html>
```



#### getCookie.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<h2>생성된 쿠키안의 정보를 출력합니다...</h2>
<%
	Cookie[ ] cs=request.getCookies();
    for( Cookie c : cs){
    	out.println(c.getName()+"-------------"+c.getValue()+"<br>");
    }
%>
</body>
</html>
```



## web12_CafeMember_Session



#### logout.jsp

```jsp
<%--
로그아웃 로직
1. 세션에 바인딩된 정보가 있다면----현재 로그인된 상태라면 --> 로그아웃
2. 세션을 죽인다.invalidate()
3. 다시 홈으로 / 로그인 페이지로
 --%>
<%@page import="servlet.model.MemberVO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    
<%
	MemberVO vo = (MemberVO)session.getAttribute("vo");
	if(vo==null){ //로그인 안된 상태이다...
%>
	<b><a href="login.html">로그인</a></b>
<%
	}else{  //로그인 된 상태이다...
		session.invalidate();//세션을 죽인다..그안에 모든것 날라간다..
	}
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	function logoutpop() {
		alert("Log Out~~!!");
	}
</script>

</head>
<body onload="return logoutpop()">
	<b>로그아웃 되셨습니다</b><br/>
	<a href="index.html">Home...</a>
</body>
</html>
```



#### login.html

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<h2>Login Page</h2>
<form action="LoginServlet" method="post">
	ID : <input type="text" name="id" required="required"><br><br>
	PASSWORD : <input type="password" name="password" required="required"><br><br>
	<input type="submit" value="Login">
</form>
</body>
</html>
```



#### EncodingFilter.java

```java
package filter;
/*
 * 클라이언트로부터 들어오는 요청을 가로채어서
 * 인코딩 작업을 필터링으로 연결한다.
 * 이후 필터 뒷부분에 나오는 모든 컴포넌트들은 여기서 작업한 필터링 작업의 효과를 얻게된다.
 */
import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;
import javax.servlet.annotation.WebInitParam;

@WebFilter(value= {"/*"})
	public class EncodingFilter implements Filter {

	public void destroy() {
		// TODO Auto-generated method stub
	}

	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		//양방향 한글처리
		request.setCharacterEncoding("utf-8");
		response.setContentType("text/html;charset=utf-8");
		
		//서버상의 다음 컴포넌트에게 계속 필터링한 작업이 연결되도록 하기 위한 작업...반드시 있어야 한다.
		chain.doFilter(request, response);
	}

	/**
	 * @see Filter#init(FilterConfig)
	 */
	public void init(FilterConfig fConfig) throws ServletException {
		
	}
}
```





[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-02.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-02.png)

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-03.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-03.png)

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-04.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-04.png)











## web13_CafeMember_FrontController

#### 

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-05.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-05.png)

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-06.png)





#### FrontController

```java
package servlet.controller;

import java.io.IOException;
import java.sql.SQLException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import servlet.model.MemberDAOImpl;
import servlet.model.MemberVO;


@WebServlet("/front.do")
public class FrontController extends HttpServlet {
	private static final long serialVersionUID = 1L;
  
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doProcess(request, response);
	}	
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doProcess(request, response);
	}
	
	protected void doProcess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		//get, post건 모두 여기서 로직을 처리...
		//1. 가장 먼저 해야하는 일이 어떤 요청이 들어왔는지를 알아야 한다...hidden 넘어온 값을 받는다.
		String command = request.getParameter("command"); //register, find, login...
		String path ="index.html";
		
		if(command.equals("register")) { //회원가입 요청..결과 페이지 연결
			//
			path=register(request,response);		
			
		}else if(command.equals("find")) { //회원검색 요청..결과 페이지 연결
			//			
			path=find(request,response);
		}else if(command.equals("login")) { //로그인 요청..결과 페이지 연결
			//
			path=login(request,response);
			
		}else if(command.equals("showAll")) { //전체회원 보기 요청..결과 페이지 연결
			path=showAll(request,response);
		}
		
		request.getRequestDispatcher(path).forward(request, response);
		//? 
	}//doProcess
	
	private String showAll(HttpServletRequest request, HttpServletResponse response) {
		MemberDAOImpl dao = MemberDAOImpl.getInstance();
		String path = "index.html";
		try {
			ArrayList<MemberVO> list=dao.showAllMember();
			request.setAttribute("list", list);
			path = "allView.jsp";
			
		}catch(Exception e) {
			
		}	
		return path;		
	}
	protected String login(HttpServletRequest request, HttpServletResponse response) {
		String id = request.getParameter("id");
		String password = request.getParameter("password");
		String path = "index.html";
		//pvo
		try {
			MemberVO rvo=MemberDAOImpl.getInstance().login(id, password);
			//로그인, 회원정보수정하기 로직은 무조건 정보를 Session Attrubute에 바인딩한다.
			//Session은 생성하는 것이 아니라...클라이언트가 요청시에 서버에서 자동적으로 만들어진다.
			HttpSession session=request.getSession(); //이렇게 세션을 받아온다.
			if(rvo!=null) { //id, password에 해당하는 vo가 있다면
				session.setAttribute("vo", rvo);
				System.out.println("JSESSIONID: "+session.getId());	
				path = "login_result.jsp";
			}
		}catch(Exception e) {
			
		}
		return path;
	}
	protected String find(HttpServletRequest request, HttpServletResponse response) {
		String path = "index.html";
		String id = request.getParameter("id");
		MemberDAOImpl dao = MemberDAOImpl.getInstance();
		try {
			MemberVO vo = dao.findByIdMember(id);
			if(vo!=null) { //id에 해당하는 Member가 있다면
				request.setAttribute("vo", vo);
				path= "result_view.jsp";
			}				
		}catch(Exception e) {
			
		}		
		return path;
	}
	protected String register(HttpServletRequest request, HttpServletResponse response) {
		String id = request.getParameter("id");
		String password = request.getParameter("password");
		String name = request.getParameter("name");
		String address = request.getParameter("address");
		
		MemberVO vo = new MemberVO(id, password, name, address);
		String path = "index.html";
		try {
			MemberDAOImpl.getInstance().registerMember(vo);
			request.setAttribute("vo", vo);
			path = "result_view.jsp";
		}catch(SQLException e) {
			
		}
		return path;
		
	}
}
```



[](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-06.png)

[![img](https://github.com/msio900/miracom_javaEduSummary/raw/master/image/1115-07.png)](https://github.com/msio900/miracom_javaEduSummary/blob/master/image/1115-07.png)



## 2. JSTL(JavaServer Pages Standard Tag Library)

- JSP에 있는 프로그램을 태그로 바꿔주는 것